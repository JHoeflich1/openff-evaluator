language: python
dist: xenial
matrix:
  include:
  - os: osx
    language: generic
    env: PYTHON_VER=3.6
  - os: osx
    language: generic
    env: PYTHON_VER=3.7
  - os: linux
    python: 3.6
    env: PYTHON_VER=3.6
  - os: linux
    python: 3.7
    env: PYTHON_VER=3.7
env:
  global:
    - OE_LICENSE="$HOME/oe_license.txt"
before_install:
- openssl aes-256-cbc -K $encrypted_c469bd55e683_key -iv $encrypted_c469bd55e683_iv
  -in oe_license.txt.enc -out $OE_LICENSE -d
- uname -a
- df -h
- ulimit -a
- source devtools/travis-ci/before_install.sh
- python -V
install:
- python devtools/scripts/create_conda_env.py -n=test -p=$PYTHON_VER devtools/conda-envs/test_env.yaml
- conda activate test

# Temporary addition until version 0.3.0 of the OFF toolkit is released.
- conda config --add channels omnia --add channels conda-forge
- conda install --yes --only-deps openforcefield
- pip install git+https://github.com/openforcefield/openforcefield.git@master

# Temporary addition until a version of yank which includes trailblaze checkpoints
# is released
- conda install --yes --only-deps yank
- pip install git+https://github.com/choderalab/yank.git@trailblaze_checkpoint

- python setup.py develop --no-deps
script:
- pytest -v --cov=propertyestimator propertyestimator/tests/
notifications:
  email: false
after_success:
- codecov
